# Home Assistant Configuration
# https://www.home-assistant.io/docs/configuration/

# --------------------------------------------------
# Core defaults (DO NOT REMOVE)
# --------------------------------------------------
default_config:

# --------------------------------------------------
# HTTP Configuration – Tailscale-only access
# --------------------------------------------------
http:
  server_port: 8123

  use_x_forwarded_for: true
  trusted_proxies:
    - 100.64.0.0/10           # Tailscale IPv4
    - fd7a:115c:a1e0::/48     # Tailscale IPv6
    - 127.0.0.1
    - ::1

  ip_ban_enabled: true
  login_attempts_threshold: 5

# Load frontend themes from the themes folder
# frontend:
#   themes: !include_dir_merged_named themes

# Text to speech
# tts:
#   - platform: alexa

# Input helpers
input_datetime: !include helpers/input_datetime.yaml

# Automations
automation: !include automations.yaml

# SimpliSafe Integration
# Configure via UI: Settings → Devices & Services → Add Integration → SimpliSafe
# Or add manually with credentials in secrets.yaml:
# simplisafe:
#   username: !secret simplisafe_username
#   password: !secret simplisafe_password

# Alexa Media Player (via Nabu Casa Cloud)
# Automatically discovered when Nabu Casa Cloud is configured
# Configure via UI: Settings → Devices & Services → Nabu Casa Cloud

# Example: If you need to manually configure Alexa Media Player
# alexa_media:
#   accounts:
#     - email: !secret alexa_email
#       password: !secret alexa_password

# Logger for debugging
logger:
  default: info
  logs:
    homeassistant.components.automation: debug
    homeassistant.components.simplisafe: info
    homeassistant.components.alexa_media: info

template:
  - sensor:
      - name: "PG&E Electricity Energy"
        unique_id: pge_electricity_energy
        unit_of_measurement: "kWh"
        device_class: energy
        state_class: total_increasing
        state: >
          {{ states('sensor.opower_pge_elec_2889422103_consumption') | float(0) }}
      - name: "PG&E Gas Energy"
        unique_id: pge_gas_energy
        unit_of_measurement: "CCF"
        device_class: gas
        state_class: total_increasing
        state: >
          {{ states('sensor.opower_pge_gas_2886724588_consumption') | float(0) }}
